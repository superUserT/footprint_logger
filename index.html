<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Standup</title>
    <link rel="icon" type="image/png" href="../images/Logo.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .activity-details {
        display: none;
        margin-top: 1rem;
        padding: 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        background-color: #f9fafb;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <!-- Floating Navbar -->
    <nav class="floating-navbar bg-blue-600 p-4 text-white">
      <div class="container mx-auto flex justify-between items-center">
        <div class="text-lg font-bold">Footprint Logger</div>
        <ul class="flex space-x-6">
          <li><a href="/home" class="hover:underline">Home</a></li>
          <li><a href="/dashboard " class="hover:underline">Dashboard</a></li>
        </ul>
      </div>
    </nav>

    <!-- Daily Standup Form -->
    <div class="flex items-center justify-center mt-8">
      <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-2xl">
        <h2 class="text-2xl font-bold text-center mb-6">Logger Input</h2>
        <form id="dailyStandupForm" class="space-y-4">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700"
              >Name:</label
            >
            <input
              type="text"
              id="name"
              name="name"
              class="mt-1 p-2 w-full border rounded-md"
              required
            />
          </div>
          <div>
            <label for="date" class="block text-sm font-medium text-gray-700"
              >Date:</label
            >
            <input
              type="date"
              id="date"
              name="date"
              class="mt-1 p-2 w-full border rounded-md"
              required
            />
          </div>

          <div>
            <label
              for="dailyActivity"
              class="block text-sm font-medium text-gray-700"
              >Daily Activity:</label
            >
            <select
              id="dailyActivity"
              name="dailyActivity"
              class="mt-1 p-2 w-full border rounded-md"
              required
              onchange="showActivityDetails(this.value)"
            >
              <option value="">-- Select an Activity --</option>
              <option value="carTravel">Car Travel</option>
              <option value="meatConsumption">Meat Consumption</option>
              <option value="electricityUse">
                Normal Electricity use for the Day
              </option>
              <option value="hotShower">Hot Shower</option>
              <option value="watchTV">Watched TV</option>
              <option value="orderedIn">Ordered In</option>
            </select>
          </div>

          <!-- Car Travel Details -->
          <div id="carTravelDetails" class="activity-details">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >Vehicle Type:</label
              >
              <select
                name="vehicleType"
                class="mt-1 p-2 w-full border rounded-md"
              >
                <option value="">-- Select Vehicle Type --</option>
                <option value="smallCar">Small Car</option>
                <option value="mediumCar">Medium Car</option>
                <option value="largeCar">Large Car</option>
                <option value="suv">SUV</option>
                <option value="pickupTruck">Pickup Truck</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >Fuel Type:</label
              >
              <select name="fuelType" class="mt-1 p-2 w-full border rounded-md">
                <option value="">-- Select Fuel Type --</option>
                <option value="petrol">Petrol</option>
                <option value="diesel">Diesel</option>
                <option value="hybrid">Hybrid</option>
                <option value="electric">Electric</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Distance (km):</label
              >
              <input
                type="number"
                name="distance"
                step="0.1"
                min="0"
                class="mt-1 p-2 w-full border rounded-md"
                placeholder="Enter distance in kilometers"
              />
            </div>
          </div>

          <!-- Meat Consumption Details -->
          <div id="meatConsumptionDetails" class="activity-details">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >Meat Type:</label
              >
              <select name="meatType" class="mt-1 p-2 w-full border rounded-md">
                <option value="">-- Select Meat Type --</option>
                <option value="beef">Beef</option>
                <option value="pork">Pork</option>
                <option value="chicken">Chicken</option>
                <option value="fish">Fish</option>
                <option value="lamb">Lamb</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Quantity (grams):</label
              >
              <input
                type="number"
                name="meatQuantity"
                min="0"
                class="mt-1 p-2 w-full border rounded-md"
                placeholder="Enter quantity in grams"
              />
            </div>
          </div>

          <!-- Electricity Use Details -->
          <div id="electricityUseDetails" class="activity-details">
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Electricity Usage (kWh):</label
              >
              <input
                type="number"
                name="electricityUsage"
                step="0.1"
                min="0"
                class="mt-1 p-2 w-full border rounded-md"
                placeholder="Enter electricity usage in kWh"
              />
            </div>
          </div>

          <!-- Hot Shower Details -->
          <div id="hotShowerDetails" class="activity-details">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >Shower Duration (minutes):</label
              >
              <input
                type="number"
                name="showerDuration"
                min="0"
                class="mt-1 p-2 w-full border rounded-md"
                placeholder="Enter shower duration in minutes"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Water Flow Rate:</label
              >
              <select
                name="waterFlowRate"
                class="mt-1 p-2 w-full border rounded-md"
              >
                <option value="">-- Select Flow Rate --</option>
                <option value="low">Low (5-7 L/min)</option>
                <option value="medium">Medium (8-10 L/min)</option>
                <option value="high">High (11+ L/min)</option>
              </select>
            </div>
          </div>

          <!-- Watched TV Details -->
          <div id="watchTVDetails" class="activity-details">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >TV Type:</label
              >
              <select name="tvType" class="mt-1 p-2 w-full border rounded-md">
                <option value="">-- Select TV Type --</option>
                <option value="led">LED</option>
                <option value="lcd">LCD</option>
                <option value="plasma">Plasma</option>
                <option value="oled">OLED</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Duration (hours):</label
              >
              <input
                type="number"
                name="tvDuration"
                step="0.1"
                min="0"
                class="mt-1 p-2 w-full border rounded-md"
                placeholder="Enter duration in hours"
              />
            </div>
          </div>

          <!-- Ordered In Details -->
          <div id="orderedInDetails" class="activity-details">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700"
                >Food Type:</label
              >
              <select
                name="foodType"
                class="mt-1 p-2 w-full border rounded-md"
                required
              >
                <option value="">-- Select Food Type --</option>
                <option value="fastFood">Fast Food</option>
                <option value="restaurant">Restaurant Meal</option>
                <option value="healthy">Healthy Meal</option>
                <option value="vegetarian">Vegetarian</option>
                <option value="vegan">Vegan</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700"
                >Packaging Type:</label
              >
              <select
                name="packagingType"
                class="mt-1 p-2 w-full border rounded-md"
                required
              >
                <option value="">-- Select Packaging --</option>
                <option value="plastic">Plastic</option>
                <option value="paper">Paper</option>
                <option value="mixed">Mixed Materials</option>
                <option value="reusable">Reusable</option>
              </select>
            </div>
          </div>

          <div class="flex justify-between">
            <button
              type="submit"
              id="submitDailyStandup"
              class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
            >
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      function showActivityDetails(activity) {
        document.querySelectorAll(".activity-details").forEach((el) => {
          el.style.display = "none";

          el.querySelectorAll("input, select").forEach((field) => {
            field.removeAttribute("required");
          });
        });

        if (activity) {
          const detailsElement = document.getElementById(`${activity}Details`);
          if (detailsElement) {
            detailsElement.style.display = "block";

            detailsElement
              .querySelectorAll("input, select")
              .forEach((field) => {
                field.setAttribute("required", "required");
              });
          }
        }
      }

      function getActivitySpecificData() {
        const activity = document.getElementById("dailyActivity").value;
        const data = {};

        switch (activity) {
          case "carTravel":
            const vehicleType = document.querySelector('[name="vehicleType"]');
            const fuelType = document.querySelector('[name="fuelType"]');
            const distance = document.querySelector('[name="distance"]');

            if (!vehicleType?.value || !fuelType?.value || !distance?.value) {
              throw new Error("Please fill in all car travel details");
            }

            data.vehicleType = vehicleType.value;
            data.fuelType = fuelType.value;
            data.distance = parseFloat(distance.value);
            break;

          case "meatConsumption":
            const meatType = document.querySelector('[name="meatType"]');
            const meatQuantity = document.querySelector(
              '[name="meatQuantity"]'
            );

            if (!meatType?.value || !meatQuantity?.value) {
              throw new Error("Please fill in all meat consumption details");
            }

            data.meatType = meatType.value;
            data.meatQuantity = parseInt(meatQuantity.value);
            break;

          case "electricityUse":
            const electricityUsage = document.querySelector(
              '[name="electricityUsage"]'
            );

            if (!electricityUsage?.value) {
              throw new Error("Please fill in electricity usage");
            }

            data.electricityUsage = parseFloat(electricityUsage.value);
            break;

          case "hotShower":
            const showerDuration = document.querySelector(
              '[name="showerDuration"]'
            );
            const waterFlowRate = document.querySelector(
              '[name="waterFlowRate"]'
            );

            if (!showerDuration?.value || !waterFlowRate?.value) {
              throw new Error("Please fill in all shower details");
            }

            data.showerDuration = parseInt(showerDuration.value);
            data.waterFlowRate = waterFlowRate.value;
            break;

          case "watchTV":
            const tvType = document.querySelector('[name="tvType"]');
            const tvDuration = document.querySelector('[name="tvDuration"]');

            if (!tvType?.value || !tvDuration?.value) {
              throw new Error("Please fill in all TV watching details");
            }

            data.tvType = tvType.value;
            data.tvDuration = parseFloat(tvDuration.value);
            break;

          case "orderedIn":
            const foodType = document.querySelector('[name="foodType"]');
            const packagingType = document.querySelector(
              '[name="packagingType"]'
            );

            if (!foodType?.value || !packagingType?.value) {
              throw new Error("Please fill in all ordering details");
            }

            data.foodType = foodType.value;
            data.packagingType = packagingType.value;
            break;
        }

        return data;
      }

      document
        .getElementById("dailyStandupForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          console.log("Form submission started...");

          const formData = {
            name: document.getElementById("name").value,
            date: document.getElementById("date").value,
            dailyActivity: document.getElementById("dailyActivity").value,
            timestamp: new Date().toISOString(),
            ...getActivitySpecificData(),
          };

          console.log("Form data:", formData);

          if (!formData.name || !formData.date || !formData.dailyActivity) {
            alert("Please fill in all required fields");
            return;
          }

          const submitButton = document.getElementById("submitDailyStandup");
          const originalText = submitButton.textContent;
          submitButton.textContent = "Submitting...";
          submitButton.disabled = true;

          try {
            const response = await fetch("/api/activities", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            console.log("Response status:", response.status);

            if (response.ok) {
              const result = await response.json();
              console.log("Success:", result);
              alert("Activity saved successfully!");
              this.reset();
              document.querySelectorAll(".activity-details").forEach((el) => {
                el.style.display = "none";
              });
            } else {
              const errorText = await response.text();
              console.error("Server error:", errorText);
              throw new Error(
                `Server error: ${response.status} - ${errorText}`
              );
            }
          } catch (error) {
            console.error("Error:", error);
            alert("Error saving activity: " + error.message);
          } finally {
            submitButton.textContent = originalText;
            submitButton.disabled = false;
          }
        });
    </script>
  </body>
</html>
